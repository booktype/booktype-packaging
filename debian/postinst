#!/bin/bash
#postinst script for Booktype

set -e

if [ "$DPKG_DEBUG" = "developer" ]; then
    set -x
fi

case "$1" in
  configure|reconfigure)

    VIRTUAL_ENV_DIR="/var/lib/booktype"

    echo -e "\n*** Installing Python libraries ***"
    ${VIRTUAL_ENV_DIR}/bin/pip install /var/lib/booktype/booktype-dependencies.pybundle || exit 1

    echo -e "\n*** Activating virtualenv ***"
    source ${VIRTUAL_ENV_DIR}/bin/activate

    echo -e "\n*** Creating Booktype instance ***"
    ${VIRTUAL_ENV_DIR}/scripts/createbooktype --check-versions --database postgresql /var/www/booktype/instance1

    echo -e "\n*** Installing symlinks for fonts ***"

    if [ ! -h /var/lib/booktype/lib/booktype/apps/core/static/core/css/font-awesome/css ] && [ -d /usr/share/fonts-font-awesome/css ]; then
       ln -s /usr/share/fonts-font-awesome/css /var/lib/booktype/lib/booktype/apps/core/static/core/css/font-awesome/css
    fi

    if [ ! -h /var/lib/booktype/lib/booktype/apps/core/static/core/css/font-awesome/font ] && [ -d /usr/share/fonts-font-awesome/fonts ]; then
       ln -s /usr/share/fonts-font-awesome/fonts /var/lib/booktype/lib/booktype/apps/core/static/core/css/font-awesome/font
    fi

  ;;

  abort-upgrade|abort-remove|abort-deconfigure)
  ;;

  *)
       echo "postinst called with unknown argument \`$1'" >&2
       exit 1
  ;;
esac

#DEBHELPER#

exit 0
